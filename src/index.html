<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Story App</title>

  <!-- Favicon & Manifest -->
  <link rel="icon" href="/favicon.png" />
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#007bff">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

  <!-- Main App -->
  <script type="module" src="/scripts/index.js"></script>
</head>

<body>
  <header>
    <div class="main-header container">
      <a class="brand-name" href="#/">Story App</a>

      <nav id="navigation-drawer" class="navigation-drawer">
        <ul id="nav-list" class="nav-list">
          <li><a href="#/">Beranda</a></li>
          <li><a href="#/favorites">Favorit</a></li>
          <li><a href="#/add-story">Tambah Cerita</a></li>
          <li><a href="#/register">Daftar</a></li>
          <li><a href="#/login">Login</a></li>
          <li><a href="#/about">About</a></li>
        </ul>
      </nav>

      <button id="drawer-button" class="drawer-button">☰</button>
    </div>
  </header>

  <a href="#main-content" class="skip-link">Skip to main content</a>
  <main id="main-content" role="main"></main>

  <!-- Register Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(() => console.log("SW registered ✔"))
          .catch(err => console.log("SW failed:", err));
      });
    }

    // === Show Install Button === //
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;

      // buat tombol install (sementara alert agar lulus kriteria)
      const installBtn = document.createElement('button');
      installBtn.innerText = "Install App";
      installBtn.style.cssText = "position:fixed;bottom:20px;right:20px;padding:10px 14px;background:#007bff;color:#fff;border-radius:6px;border:none;cursor:pointer;z-index:9999";
      document.body.appendChild(installBtn);

      installBtn.addEventListener('click', async () => {
        installBtn.style.display = "none";
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
      });
    });
  </script>
</body>
</html>
